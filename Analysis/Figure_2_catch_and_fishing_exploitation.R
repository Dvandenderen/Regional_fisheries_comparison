
# makes plots to estimate F/FMSY
library(ggplot2)

# source NW Europe
source('Analysis/NWEU_Weighted_F_Fmsy.R')

# source Northwest Atlantic
source('Analysis/NWAT_Weighted_F_Fmsy.R')

# source alaska
source('Analysis/ALAS_Weighted_F_Fmsy.R')

# create combined plot
pdf("Output/Figure_2.pdf",width = 8.3,height = 6.5)
layout(matrix(c(1,2,3,1,2,3,4,5,6,4,5,6,4,5,6), nrow = 5, ncol = 3, byrow = TRUE))
# get value of catch and landings
land <- matrix(data= c(2318, 1567,273,
                       138, 1949,382,
                       65,360,626),ncol=3)
rownames(land) <- c("Alaska","NW EU","NE America")
colnames(land) <- c("Dem","Pel","Inv")
barplot(t(land), col=c("#2c7fb8","#7fcdbb","#edf8b1"),yaxt="n",ylim=c(0,4000),ylab="Landings (1000 MT)")
axis(2,c(0,2000,4000),las=1)

val <- matrix(data= c(1891, 2538,667,
                       238,  1319,267,
                       252,  1164,3478),ncol=3)
rownames(val) <- c("Alaska","NW EU","NE America")
colnames(val) <- c("Dem","Pel","Inv")
barplot(t(val), col=c("#2c7fb8","#7fcdbb","#edf8b1"),yaxt="n",ylim=c(0,5000),ylab="Value (million US$)")
axis(2,c(0,2500,5000),las=1)

# now get level of overfished
reg <- NWEUR[1:42,]
lo <- loess((reg$overexplot/reg$numb*100)~reg$years)
plot(reg$years,(reg$overexplot/reg$numb*100),col="white",ylim=c(0,100),yaxt="n",
     ylab="% overexploited",las=1,xlab="Years",xlim=c(1980,2021),xaxs="i")
lines(predict(lo)~reg$years, col='black', lwd=2,lty=5)
axis(2,las=1,c(0,50,100))
mean(reg$numb)

reg <- NEUS[3:40,]
lo <- loess((reg$overexplot/reg$numb*100)~reg$years)
lines(predict(lo)~reg$years, col='blue', lwd=2,lty=2)
mean(reg$numb)

reg <- Alaska[1:40,]
lo <- loess((reg$overexplot/reg$numb*100)~reg$years)
lines(predict(lo)~reg$years, col='red', lwd=2,lty=1)
mean(reg$numb)

#legend(x=2006,y=107,"a)",bty="n",inset=0)

legend("topleft", text.width=c(10),
       inset = c(0, -0.25), bty = "n", x.intersp=0.5,
       xjust=0, yjust=0,
       legend=c("NW EU (27)","NE America (19)","Alaska (21)"),
       col=c("black", "blue", "red"), lty=c(5,2,1),
       lwd=2, cex = 0.75, xpd = TRUE,ncol=2,seg.len = 1)

# West Europe
reg <- NWEUR[1:42,]
plot(reg$value~reg$years,type="b",ylim=c(0,2),col="white",xlab="Years",ylab="F/Fmsy",las=1,xaxs="i")
polygon(x= c(reg$years, rev(reg$years)), 
        y = c(reg$conf1,rev(reg$conf2)), col = adjustcolor("grey", alpha.f = 0.2),border = NA)
lines(reg$value~reg$years)
box()
#legend("topright","a)",bty="n")

# northeast US
reg <- NEUS[3:40,]
plot(reg$value~reg$years,type="b",ylim=c(0,2),col="white",xlab="Years",ylab="",las=1,xaxs="i",
     xlim=c(1980,2021))
polygon(x= c(reg$years, rev(reg$years)), 
        y = c(reg$conf1,rev(reg$conf2)), col = adjustcolor("blue", alpha.f = 0.1),border = NA)
lines(reg$value~reg$years,col="blue")
box()
#legend("topright","b)",bty="n")

# alaska
reg <- Alaska[1:40,]
plot(reg$value~reg$years,type="b",ylim=c(0,2),col="white",xlab="Years",ylab="",las=1,xaxs="i",
     xlim=c(1980,2021))
polygon(x= c(reg$years, rev(reg$years)), 
        y = c(reg$conf1,rev(reg$conf2)), col = adjustcolor("red", alpha.f = 0.1),border = NA)
lines(reg$value~reg$years,col="red")
box()
#legend("topright","c)",bty="n")
# save 8.3 by 6.5
dev.off()


par(mfrow=c(1,2))


# plot 2
tot <- rbind(sumEU,sumneus,sumala)
plot(tot$meanfmsy,ylim=c(0,0.40),xaxt="n",xlim=c(0.5,3.5),
     col=c("black","blue","red"),pch=16, 
     ylab="Biomass-weighted Fmsy",xlab="Region",las=1)

# vertical arrow
arrows(x0=c(1,2,3), y0=tot$conf1, 
       x1=c(1,2,3), y1=tot$conf2, 
       code=3, col=c("black","blue","red"), lwd=2,angle=90, length=0.1)

axis(1,c(1,2,3),c("NW EU","NE US","Alaska"))
text(x=0.72,y=0.37,"b)",bty="n")
