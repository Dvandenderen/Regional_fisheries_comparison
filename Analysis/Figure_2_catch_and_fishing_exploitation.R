
# ------------------------------------------------------------------------------
# makes plots to estimate F/FMSY
# ------------------------------------------------------------------------------

# load libraries
library(ggplot2)

# load F/FMS data
source('Analysis/NWEU_Weighted_F_Fmsy.R') # source NW Europe
source('Analysis/NWAT_Weighted_F_Fmsy.R') # source Northwest Atlantic
source('Analysis/ALAS_Weighted_F_Fmsy.R') # source alaska

# create combined plot
pdf("Output/Figure_2.pdf", width = 8.3, height = 9.5)
layout(matrix(
  c(1, 2, 3, 1, 2, 3, 4, 5, 6, 4, 5, 6, 4, 5, 6, 7, 8, 9, 7, 8,9),
  nrow = 7,
  ncol = 3,
  byrow = TRUE))

# get landings
land <- matrix(data = c(1567, 273, 2318,
                        1949, 382, 138,
                        360, 626, 65),
               ncol = 3)
rownames(land) <- c("NW EU", "NW Atlantic", "Alaska")
colnames(land) <- c("Dem", "Pel", "Inv")
barplot(
  t(land),
  col = c("#2c7fb8", "#7fcdbb", "#edf8b1"),
  yaxt = "n",
  ylim = c(0, 4000),
  ylab = "Landings (1000 MT)"
)
axis(2, c(0, 2000, 4000), las = 1)

# get value of landings
val <- matrix(data = c(2538, 667, 1891,
                       1319, 267, 238,
                       1164, 3478, 252),
              ncol = 3)
rownames(val) <- c("NW EU", "NW Atlantic", "Alaska")
colnames(val) <- c("Dem", "Pel", "Inv")
barplot(
  t(val),
  col = c("#2c7fb8", "#7fcdbb", "#edf8b1"),
  yaxt = "n",
  ylim = c(0, 5000),
  ylab = "Value (million US$)"
)
axis(2, c(0, 2500, 5000), las = 1)

# now get level of overfished
reg <- NWEUR[1:42, ]
lo <- loess((reg$overexplot / reg$numb * 100) ~ reg$years)
plot(reg$years, (reg$overexplot / reg$numb * 100),
  col = "white",
  ylim = c(0, 100),
  yaxt = "n",
  ylab = "% overexploited",
  las = 1,
  xlab = "Years",
  xlim = c(1980, 2021),
  xaxs = "i",yaxs="i")

lines(predict(lo) ~ reg$years,col = 'black',lwd = 2,lty = 5)
axis(2, las = 1, c(0, 50, 100))
mean(reg$numb)

reg <- NEUS[3:40, ]
lo <- loess((reg$overexplot / reg$numb * 100) ~ reg$years)
lines(predict(lo) ~ reg$years,col = 'blue',lwd = 2,lty = 2)
mean(reg$numb)

reg <- Alaska[1:40, ]
lo <- loess((reg$overexplot / reg$numb * 100) ~ reg$years)
lines(predict(lo) ~ reg$years,col = 'red',lwd = 2,lty = 1)
mean(reg$numb)

legend(
  "topleft",
  text.width = c(10),
  inset = c(0,-0.25),
  bty = "n",
  x.intersp = 0.5,
  xjust = 0,
  yjust = 0,
  legend = c("NW EU (27)", "NW Atlantic (19)", "Alaska (21)"),
  col = c("black", "blue", "red"),
  lty = c(5, 2, 1),
  lwd = 2,
  cex = 0.75,
  xpd = TRUE,
  ncol = 2,
  seg.len = 1
)

# West Europe
reg <- NWEUR[1:42, ]
plot(
  reg$value ~ reg$years,
  type = "b",
  ylim = c(0, 2),
  col = "white",
  xlab = "Years",
  ylab = "F/Fmsy",
  las = 1,
  xaxs = "i"
)
polygon(
  x = c(reg$years, rev(reg$years)),
  y = c(reg$conf1, rev(reg$conf2)),
  col = adjustcolor("grey", alpha.f = 0.2),
  border = NA
)
lines(reg$value ~ reg$years)
box()
#legend("topright","a)",bty="n")

# northwest atlantic
reg <- NEUS[3:40, ]
plot(
  reg$value ~ reg$years,
  type = "b",
  ylim = c(0, 2),
  col = "white",
  xlab = "Years",
  ylab = "",
  las = 1,
  xaxs = "i",
  xlim = c(1980, 2021)
)
polygon(
  x = c(reg$years, rev(reg$years)),
  y = c(reg$conf1, rev(reg$conf2)),
  col = adjustcolor("blue", alpha.f = 0.1),
  border = NA
)
lines(reg$value ~ reg$years, col = "blue")
box()

# alaska
reg <- Alaska[1:40, ]
plot(
  reg$value ~ reg$years,
  type = "b",
  ylim = c(0, 2),
  col = "white",
  xlab = "Years",
  ylab = "",
  las = 1,
  xaxs = "i",
  xlim = c(1980, 2021)
)
polygon(
  x = c(reg$years, rev(reg$years)),
  y = c(reg$conf1, rev(reg$conf2)),
  col = adjustcolor("red", alpha.f = 0.1),
  border = NA
)
lines(reg$value ~ reg$years, col = "red")
box()


# get landings
land <- matrix(data = c(c(1567/1421, 273/375, 2318/1315),#/1845,
                        c(1949/1421, 382/375, 138/1315),# /2989,
                        c(360/1421, 626/375, 65/1315)), #/766),
               ncol = 3)
rownames(land) <- c("NW EU", "NW Atlantic", "Alaska")
colnames(land) <- c("Dem", "Pel", "Inv")
barplot(
  t(land),
  col = c("#2c7fb8", "#7fcdbb", "#edf8b1"),
  yaxt = "n",
  ylim = c(0, 3.6),
  ylab = "Landings (MT per km2)"
)
axis(2, c(0, 1.8, 3.6), las = 1)


dev.off()
